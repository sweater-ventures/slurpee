# Ralph Progress Log
Started: Fri Feb  7 20:15:00 MST 2026
---

## Codebase Patterns
- `emit_interface: true` in sqlc.yaml generates a populated `Querier` interface with all query methods
- `Application.DB` is typed as `db.Querier` (interface), not `*db.Queries` (concrete) — enables mock injection for testing
- Functions that accept a DB parameter should use `db.Querier` interface type, not `*db.Queries`
- `go build ./...` is the primary quality check; `go vet ./...` for additional static analysis
- Unexported functions (`matchesFilter`, `calculateBackoff`) require `package app` test files, not `package app_test`
- API handler tests: use `callHandler(t, slurpee, handler, req)` helper wrapping `routeHandler` — no full server needed
- Happy-path POST /events tests must mock `GetLogConfigBySubject` (called by `LogEvent`) — return error to skip
- GET handler tests need `req.SetPathValue("id", ...)` since `callHandler` bypasses the mux router
- Subscriber endpoint auth uses simple string comparison (`config.AdminSecret`), not bcrypt — use `WithAdminSecret(req, "test-admin-secret")`
- `package app` test files CANNOT import `testutil` (import cycle: testutil → app) — duplicate mock/factory locally in test file
- Migration files use `-- +migrate Up` / `-- +migrate Down` format — parse only Up section for test setup
- POST /subscribers returns 200 (not 201) — handler uses `http.StatusOK`
- `db.New(conn)` returns `*db.Queries` satisfying `db.Querier` — use for real DB test setup
- API secrets use bcrypt hashing — seed helpers must use `golang.org/x/crypto/bcrypt` to create real hashes
- Glob wildcards use `*` (not `%`) for subject pattern matching
- Deduplication groups subscriptions by subscriber_id and picks highest max_retries

---
