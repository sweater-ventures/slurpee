# Ralph Progress Log
Started: Thu Feb  5 19:20:00 MST 2026

## Codebase Patterns
- Use `IF NOT EXISTS` for all CREATE TABLE and CREATE INDEX statements in migrations
- sql-migrate uses `-- +migrate Up` and `-- +migrate Down` comment markers
- Source .env before running sql-migrate: `set -a && source .env && set +a && sql-migrate up`
- dbconfig.yml uses `host=${DB_HOST} dbname=${DB_NAME} user=${DB_ADMIN_USERNAME} password=${DB_ADMIN_PASSWORD} sslmode=disable` format
- DB admin credentials are in .env as DB_ADMIN_USERNAME/DB_ADMIN_PASSWORD; app credentials as DB_USERNAME/DB_PASSWORD
- sqlc config at sqlc.yaml uses pgx/v5 driver with custom type overrides for timestamptz and nullable text
- Build with `go build ./...` to verify no compilation errors
- Makefile `db/models.go` target runs `go tool sqlc generate` when query or schema files change
- Use `sqlc.arg(name)` for named parameters in sqlc queries to get clean Go struct field names
- JSONB containment search: `WHERE data @> $1` with `@>` operator
- PostgreSQL TEXT[] maps to Go `[]string` in sqlc without needing a custom override
- Go 1.22+ method routing: use `"POST /events"` pattern in ServeMux for method-restricted routes
- API routes register under `/events` (not `/api/events`) — the `/api` prefix is stripped by AddApis()
- Use `pgtype.UUID{Valid: false}` for nullable UUID columns (SQL NULL); `json.RawMessage` for JSONB round-tripping
- Admin-protected endpoints validate `X-Slurpee-Admin-Secret` header against `app.Config.AdminSecret`
- Idempotent subscriber registration: upsert by endpoint_url, then delete + recreate subscriptions
- Path parameters: `"GET /events/{id}"` route pattern + `r.PathValue("id")` to extract; use `pgx.ErrNoRows` with `errors.Is()` for 404
- Async delivery: `deliverEvent(app, event)` in api/delivery.go triggers background goroutine after event persistence; uses `context.Background()` not request context
- Per-subscriber concurrency: buffered channel `make(chan struct{}, maxParallel)` as semaphore pattern
- SimplePage requires two params: `SimplePage(title, currentPath)` — currentPath enables active sidebar highlighting
- Templ generate: `go tool templ generate -f <file>` for specific files; `go build ./...` after to verify
- HTMX partial rendering: extract content into a separate templ component, use hx-target/hx-swap to replace just that section
- DaisyUI modal: `<dialog class="modal">` with `.showModal()`/`.close()`, `<form method="dialog">` for cancel button
- Templ `script` keyword for type-safe JS functions callable from `onclick={ funcName(args) }`
- HTMX edit pattern: use `hx-put` for updates, `hx-delete` for deletes, `hx-post` for creates; all target a shared content div
- `hx-confirm` attribute provides simple browser-native confirmation dialogs — simpler than DaisyUI modals for destructive actions
- Shared `buildXxxDetailView()` helper pattern: extract DB fetch + transform logic to reduce duplication across detail/update/create/delete handlers

---

