# Ralph Progress Log
Started: Wed Feb  4 15:46:59 MST 2026

## Codebase Patterns
- Use `IF NOT EXISTS` for all CREATE TABLE and CREATE INDEX statements in migrations
- sql-migrate uses `-- +migrate Up` and `-- +migrate Down` comment markers
- Source .env before running sql-migrate: `set -a && source .env && set +a && sql-migrate up`
- dbconfig.yml uses `host=${DB_HOST} dbname=${DB_NAME} user=${DB_ADMIN_USERNAME} password=${DB_ADMIN_PASSWORD} sslmode=disable` format
- DB admin credentials are in .env as DB_ADMIN_USERNAME/DB_ADMIN_PASSWORD; app credentials as DB_USERNAME/DB_PASSWORD
- sqlc config at sqlc.yaml uses pgx/v5 driver with custom type overrides for timestamptz and nullable text
- Build with `go build ./...` to verify no compilation errors
- Makefile `db/models.go` target runs `go tool sqlc generate` when query or schema files change
- Use `sqlc.arg(name)` for named parameters in sqlc queries to get clean Go struct field names
- JSONB containment search: `WHERE data @> $1` with `@>` operator
- PostgreSQL TEXT[] maps to Go `[]string` in sqlc without needing a custom override
- Go 1.22+ method routing: use `"POST /events"` pattern in ServeMux for method-restricted routes
- API routes register under `/events` (not `/api/events`) — the `/api` prefix is stripped by AddApis()
- Use `pgtype.UUID{Valid: false}` for nullable UUID columns (SQL NULL); `json.RawMessage` for JSONB round-tripping
- Admin-protected endpoints validate `X-Slurpee-Admin-Secret` header against `app.Config.AdminSecret`
- Idempotent subscriber registration: upsert by endpoint_url, then delete + recreate subscriptions
- Path parameters: `"GET /events/{id}"` route pattern + `r.PathValue("id")` to extract; use `pgx.ErrNoRows` with `errors.Is()` for 404
- Async delivery: `deliverEvent(app, event)` in api/delivery.go triggers background goroutine after event persistence; uses `context.Background()` not request context
- Per-subscriber concurrency: buffered channel `make(chan struct{}, maxParallel)` as semaphore pattern
- SimplePage requires two params: `SimplePage(title, currentPath)` — currentPath enables active sidebar highlighting
- Templ generate: `go tool templ generate -f <file>` for specific files; `go build ./...` after to verify

---

## 2026-02-04 15:48 MST - US-001
- Created events table migration: schema/20260204154757-create-events-table.sql
- Table has 8 columns: id (UUID PK), subject, timestamp, trace_id, data (JSONB), retry_count, delivery_status, status_updated_at
- Three indexes: subject, timestamp, delivery_status
- Migration applies cleanly via sql-migrate up
- Files changed: schema/20260204154757-create-events-table.sql
- **Learnings for future iterations:**
  - The database was already provisioned via Docker with slurpee_admin and slurpee roles
  - gorp_migrations table tracks applied migrations (used by sql-migrate)
  - Previous session work wasn't on a persisted branch, so had to recreate from scratch
  - Always verify migration status with `sql-migrate status` after applying
---

## 2026-02-04 15:56 MST - US-002
- Created subscribers table migration: schema/20260204155540-create-subscribers-table.sql
- Table has 7 columns: id (UUID PK), name, endpoint_url (unique), auth_secret, max_parallel (default 1), created_at (default now), updated_at (default now)
- Unique constraint on endpoint_url enforced via UNIQUE keyword in column definition
- Migration applies cleanly, build passes
- Files changed: schema/20260204155540-create-subscribers-table.sql
- **Learnings for future iterations:**
  - UNIQUE keyword on column definition creates both a unique constraint and implicit unique index (no separate CREATE INDEX needed)
  - Following the same migration pattern as US-001 (IF NOT EXISTS, consistent formatting) works well
---

## 2026-02-04 16:01 MST - US-003
- Created subscriptions table migration: schema/20260204160051-create-subscriptions-table.sql
- Table has 7 columns: id (UUID PK), subscriber_id (UUID FK to subscribers with CASCADE DELETE), subject_pattern, filter (JSONB nullable), max_retries (integer nullable), created_at (default now), updated_at (default now)
- Index on subject_pattern for delivery routing lookups
- Foreign key constraint ensures subscriptions are deleted when parent subscriber is removed
- Migration applies cleanly, build passes
- Files changed: schema/20260204160051-create-subscriptions-table.sql
- **Learnings for future iterations:**
  - Foreign key with CASCADE DELETE syntax: `REFERENCES table(column) ON DELETE CASCADE` inline with column definition
  - Nullable columns simply omit NOT NULL (no special syntax needed for JSONB or INTEGER nullable fields)
  - The subscriptions table links subscribers to subject patterns — this is the many-to-many relationship that will be used for delivery routing
---

## 2026-02-04 16:03 MST - US-004
- Created delivery_attempts table migration: schema/20260204160332-create-delivery-attempts-table.sql
- Table has 10 columns: id (UUID PK), event_id (UUID FK to events), subscriber_id (UUID FK to subscribers), endpoint_url (text), attempted_at (timestamptz default now), request_headers (jsonb nullable), response_status_code (integer nullable), response_headers (jsonb nullable), response_body (text nullable), status (text not null)
- Foreign key constraints to both events and subscribers tables (no CASCADE DELETE — delivery history should be preserved)
- Three indexes: event_id, subscriber_id, status
- Migration applies cleanly, build passes
- Files changed: schema/20260204160332-create-delivery-attempts-table.sql
- **Learnings for future iterations:**
  - Foreign keys without CASCADE DELETE are the default — simply use REFERENCES table(column) without ON DELETE clause
  - delivery_attempts does NOT use CASCADE DELETE because delivery history should be preserved even if subscribers are removed (unlike subscriptions which are config data)
  - Status values will be 'succeeded', 'failed', 'pending' — enforced by application logic, not DB constraint
---

## 2026-02-04 16:15 MST - US-005
- Created log_config table migration: schema/20260204161528-create-log-config-table.sql
- Table has 3 columns: id (UUID PK), subject (text, not null, unique), log_properties (text array, not null)
- Unique constraint on subject enforced via UNIQUE keyword (creates implicit unique index, no separate CREATE INDEX needed)
- Migration applies cleanly, build passes
- Files changed: schema/20260204161528-create-log-config-table.sql
- **Learnings for future iterations:**
  - PostgreSQL TEXT[] type is used for text arrays — stores a list of JSON property paths
  - The log_config table is the simplest schema table (no foreign keys, no timestamps) since it's pure configuration
  - All five database schema tables (events, subscribers, subscriptions, delivery_attempts, log_config) are now complete
  - Next stories (US-006 through US-009) will create sqlc query files in queries/ directory
---

## 2026-02-04 16:22 MST - US-006
- Created sqlc query file: queries/events.sql with 8 query definitions
- Queries: InsertEvent, GetEventByID, ListEvents (paginated), SearchEventsBySubject, SearchEventsByDateRange, SearchEventsByDeliveryStatus, SearchEventsByDataContent (jsonb @> containment), UpdateEventDeliveryStatus
- Generated code: db/events.sql.go (307 lines) and db/models.go (59 lines with all 5 table models)
- Files changed: queries/events.sql, db/events.sql.go, db/models.go
- **Learnings for future iterations:**
  - sqlc uses `sqlc.arg(name)` syntax for named parameters — use this to get clean Go struct field names instead of auto-generated ones like `Timestamp_2`
  - JSONB containment search uses `@>` operator: `WHERE data @> $1` — caller passes a JSON byte slice to match against
  - sqlc generates a `models.go` file with Go structs for ALL tables in the schema, even those without queries yet
  - The querier.go interface is currently empty — it will be populated as more query files are added
  - `go tool sqlc generate` is the correct invocation (not just `sqlc generate`)
  - Generated files go to db/ directory as configured in sqlc.yaml
---

## 2026-02-04 16:28 MST - US-007
- Created sqlc query file: queries/subscribers.sql with 9 query definitions
- Subscriber queries: UpsertSubscriber (ON CONFLICT by endpoint_url), GetSubscriberByID, GetSubscriberByEndpointURL, ListSubscribers, DeleteSubscriber
- Subscription queries: CreateSubscription, ListSubscriptionsForSubscriber, DeleteSubscriptionsForSubscriber, GetSubscriptionsMatchingSubject
- GetSubscriptionsMatchingSubject uses SQL LIKE with replace() to convert glob patterns (* → %, ? → _) for delivery routing
- Generated code: db/subscribers.sql.go (240 lines)
- Files changed: queries/subscribers.sql, db/subscribers.sql.go
- **Learnings for future iterations:**
  - PostgreSQL ON CONFLICT DO UPDATE uses EXCLUDED.column_name to reference the values that would have been inserted
  - The upsert pattern returns the full row via RETURNING * regardless of whether it was an insert or update
  - For glob/wildcard matching in SQL, use replace() to convert * to % and ? to _ with LIKE operator
  - Only new files were created — existing db/models.go, db/db.go, db/querier.go, db/events.sql.go were unchanged by sqlc generate
  - sqlc correctly generates separate .sql.go files per query source file (events.sql.go, subscribers.sql.go)
---

## 2026-02-04 16:30 MST - US-008
- Created sqlc query file: queries/delivery_attempts.sql with 4 query definitions
- Queries: InsertDeliveryAttempt (all 10 columns), ListDeliveryAttemptsForEvent (ordered by attempted_at), ListDeliveryAttemptsForSubscriber (ordered by attempted_at), UpdateDeliveryAttemptStatus (updates status, response_status_code, response_headers, response_body)
- Generated code: db/delivery_attempts.sql.go (167 lines)
- Files changed: queries/delivery_attempts.sql, db/delivery_attempts.sql.go
- **Learnings for future iterations:**
  - The UpdateDeliveryAttemptStatus query updates response fields alongside status because in the delivery engine flow, a delivery attempt is first inserted with status 'pending' and then updated with the response data after the HTTP call completes
  - The InsertDeliveryAttempt params struct uses pgtype.Timestamptz for attempted_at (via sqlc override) and pgtype.Int4 for nullable response_status_code
  - JSONB columns (request_headers, response_headers) map to []byte in Go — caller is responsible for marshaling/unmarshaling JSON
  - Nullable text column (response_body) maps to string due to sqlc.yaml override for pg_catalog.text nullable
---

## 2026-02-04 16:34 MST - US-009
- Created sqlc query file: queries/log_config.sql with 4 query definitions
- Queries: UpsertLogConfig (ON CONFLICT by subject, updates log_properties), GetLogConfigBySubject, ListLogConfigs (ordered alphabetically by subject), DeleteLogConfigForSubject
- Generated code: db/log_config.sql.go (78 lines)
- Files changed: queries/log_config.sql, db/log_config.sql.go
- **Learnings for future iterations:**
  - PostgreSQL TEXT[] maps to Go []string in sqlc — no special override needed
  - The log_config upsert only updates log_properties on conflict (not id) since subject is the unique key used for lookups
  - All four sqlc query file stories (US-006 through US-009) are now complete, covering events, subscribers/subscriptions, delivery_attempts, and log_config
  - The sqlc query layer is fully implemented — next stories (US-010+) move to REST API endpoint implementation
---

## 2026-02-04 16:40 MST - US-010
- Implemented POST /api/events endpoint in api/events.go
- Accepts JSON body with subject (required), data (required JSON object), id (optional UUID v7), timestamp (optional, defaults to now), trace_id (optional UUID)
- Returns 201 with created event including assigned id and timestamp
- Returns 400 with error details for missing/invalid fields (subject, data, id, trace_id)
- Validates data is a JSON object (not array, string, etc.)
- Uses uuid.NewV7() from google/uuid for auto-generated event IDs
- Persists to database via app.DB.InsertEvent before responding
- Logs event subject and ID on receipt using slog via context logger
- Follows existing routeHandler/writeJsonResponse/init() pattern
- Helper functions: eventToResponse() converts db.Event to API response, uuidToString() converts pgtype.UUID to string
- Files changed: api/events.go (new)
- **Learnings for future iterations:**
  - Go 1.22+ method-based routing: `"POST /events"` pattern restricts to POST only without manual method checking
  - pgtype.UUID with Valid:false represents SQL NULL — use this for optional UUID fields like trace_id
  - json.RawMessage preserves raw JSON for request parsing and response serialization (no double-encoding)
  - The api/ package routes are stripped of `/api` prefix by AddApis(), so register as `/events` not `/api/events`
  - uuid.Must(uuid.NewV7()) generates time-ordered UUIDs for natural chronological ordering
---

## 2026-02-04 16:48 MST - US-011
- Implemented POST /api/subscribers endpoint in api/subscribers.go
- Added ADMIN_SECRET field to AppConfig in config/configuration.go (env var ADMIN_SECRET)
- Accepts JSON body with name (required), endpoint_url (required), auth_secret (required), max_parallel (optional, default 1), subscriptions (required array with subject_pattern + optional filter/max_retries)
- Validates X-Slurpee-Admin-Secret header against app.Config.AdminSecret; returns 401 if invalid
- Upserts subscriber by endpoint_url (creates new or updates existing with same endpoint)
- On upsert, deletes existing subscriptions and recreates them (idempotent replace)
- Returns 200 with full subscriber and subscriptions as JSON
- Returns 400 for missing required fields
- Files changed: api/subscribers.go (new), config/configuration.go (added AdminSecret field)
- **Learnings for future iterations:**
  - Admin-protected endpoints check X-Slurpee-Admin-Secret header against app.Config.AdminSecret
  - The upsert + delete-and-recreate pattern for subscriptions ensures idempotent replacement: subscriber is upserted by endpoint_url, then all subscriptions are deleted and recreated fresh
  - pgtype.Int4{Int32: value, Valid: true} for nullable integer columns, pgtype.Int4{} (zero value) for NULL
  - json.RawMessage works for optional JSONB filter fields — check for nil/null before passing to DB as []byte
  - AppConfig uses go-arg library with struct tags for env var binding: `arg:"--flag,env:ENV_VAR" default:"value"`
---

## 2026-02-04 16:55 MST - US-012
- Implemented GET /api/events/{id} endpoint in api/events.go (added to existing file)
- Parses {id} path parameter using r.PathValue("id") (Go 1.22+ ServeMux feature)
- Validates UUID format, returns 400 if invalid
- Calls app.DB.GetEventByID, returns 404 if not found (checks errors.Is(err, pgx.ErrNoRows))
- Returns 200 with full event JSON using existing eventToResponse() helper
- Registered via init() alongside existing POST /events route
- Files changed: api/events.go (added getEventHandler, new imports for errors and pgx)
- **Learnings for future iterations:**
  - Go 1.22+ path parameters: use `{name}` in route pattern and `r.PathValue("name")` to extract — no external router needed
  - pgx.ErrNoRows sentinel error with errors.Is() for detecting "not found" from :one queries
  - Multiple routes can be registered in the same init() block by calling router.Handle multiple times
---

## 2026-02-04 16:57 MST - US-013
- Implemented GET /api/subscribers endpoint in api/subscribers.go (added to existing file)
- Lists all subscribers with their subscriptions as a JSON array
- Validates X-Slurpee-Admin-Secret header (401 if missing/incorrect)
- Returns empty array [] if no subscribers registered
- For each subscriber, fetches subscriptions via ListSubscriptionsForSubscriber and converts using existing helper functions
- Registered via init() alongside existing POST /subscribers route
- Files changed: api/subscribers.go (added listSubscribersHandler, +40 lines)
- **Learnings for future iterations:**
  - Reuse existing response type structs and converter functions (subscriberToResponse, subscriptionToResponse) — no new types needed for GET list endpoints
  - Admin auth pattern is duplicated per handler — a middleware would reduce duplication if more admin endpoints are added
  - Initialize nil slices to empty (`[]Type{}`) before JSON serialization to return `[]` instead of `null`
---

## 2026-02-04 17:05 MST - US-014
- Implemented event delivery engine in api/delivery.go
- After POST /api/events stores the event, deliverEvent() is called to trigger async delivery in a background goroutine
- Uses GetSubscriptionsMatchingSubject (SQL LIKE with glob-to-SQL conversion) to find matching subscriptions
- Groups subscriptions by subscriber, loads subscriber details, then delivers in parallel
- Per-subscriber concurrency limited by max_parallel using buffered channel as semaphore
- Each delivery sends HTTP POST to subscriber endpoint_url with event data as JSON body
- X-Slurpee-Secret header set to subscriber's auth_secret for authentication
- Delivery attempts recorded in delivery_attempts table with request headers, response status/headers/body, and status
- 2xx responses marked as "succeeded", all others as "failed"
- Event delivery_status updated after all attempts complete: "delivered" (all succeeded), "failed" (any failed)
- Events with no matching subscriptions marked as "delivered"
- Files changed: api/delivery.go (new, ~236 lines), api/events.go (added deliverEvent call after event persistence)
- **Learnings for future iterations:**
  - pgtype.UUID is comparable and works as a Go map key (struct with [16]byte array + bool)
  - Buffered channels (`make(chan struct{}, n)`) work as simple semaphores for per-subscriber concurrency control
  - Background goroutines need context.Background() not the request context, since the HTTP request context is cancelled after response is sent
  - The delivery engine is intentionally decoupled from subscription filters (US-016) and retry logic (US-015) to keep stories focused
  - HTTP client should have a timeout (30s) to prevent hanging on unresponsive subscriber endpoints
  - Response body reading should be limited (1MB) to prevent memory issues from large responses
---

## 2026-02-05 11:50 MST - US-015
- Implemented delivery retry with exponential backoff in api/delivery.go
- Added MAX_RETRIES (default 5) and MAX_BACKOFF_SECONDS (default 300) config fields to AppConfig
- Refactored delivery engine to track per-subscription retry state using deliveryTask struct
- deliveryResult struct tracks final outcome per subscription (succeeded or exhausted)
- Exponential backoff: 1s, 2s, 4s, 8s, 16s... capped at MaxBackoffSeconds
- Per-subscription max_retries override takes precedence over global default
- New "partial" delivery status used while some subscriptions succeeded and others are still retrying
- Each retry attempt recorded as new row in delivery_attempts table
- retry_count on event incremented for each retry cycle
- status_updated_at updated on each status change
- Files changed: api/delivery.go (major refactor, +150 lines), config/configuration.go (added 2 config fields)
- **Learnings for future iterations:**
  - Package-level type definitions needed when types are used across multiple functions (deliveryResult couldn't be local to dispatchEvent and used in processDeliveryTask)
  - Recursive goroutine pattern works for retry scheduling: processDeliveryTask spawns itself after delay
  - math.Pow for exponential calculation, cap result with min() against max seconds
  - time.Sleep in a new goroutine allows non-blocking retry scheduling while maintaining WaitGroup tracking
---

## 2026-02-05 12:55 MST - US-016
- Implemented subscription filter evaluation for event delivery in api/delivery.go
- Added matchesFilter() function that evaluates subscription filter JSON against event data
- Filter semantics: JSON object with key-value pairs, ALL must match (AND logic) against top-level keys in event data
- Null/empty filter means "match all events" (no filtering)
- Non-matching subscriptions are skipped silently — no delivery attempt is recorded
- Filter check happens in dispatchEvent() when building delivery tasks, before any HTTP calls
- Uses JSON marshal/unmarshal for type-safe value comparison (handles strings, numbers, booleans, nested objects correctly)
- Files changed: api/delivery.go (+57 lines)
- **Learnings for future iterations:**
  - JSON comparison via marshal-to-string handles type coercion correctly (1 != "1", true != "true")
  - Filter evaluation happens early in the delivery pipeline to avoid unnecessary HTTP calls and delivery_attempts rows
  - Subscription.Filter is []byte (JSONB from Postgres), check len(filter) == 0 for null/empty
  - Using json.Unmarshal to map[string]interface{} works for arbitrary JSON object comparison
---

## 2026-02-05 13:30 MST - US-017
- Implemented configurable event data logging in api/events.go createEventHandler
- After event is persisted, looks up log_config for the event subject via GetLogConfigBySubject
- If a log_config exists, extracts listed property paths from the already-parsed dataObj (map[string]any) and appends them as structured slog fields
- Event ID and subject are always logged regardless of log_config
- If no log_config exists (GetLogConfigBySubject returns error), only event ID and subject are logged
- Files changed: api/events.go (+11 lines, -1 line)
- **Learnings for future iterations:**
  - The dataObj variable from JSON validation (line 61-62) is already available as map[string]any — reuse it for property extraction rather than re-parsing event.Data
  - Silently ignoring GetLogConfigBySubject errors (including pgx.ErrNoRows) is the correct approach: missing config means "log defaults only"
  - slog variadic args pattern: build []any slice with key-value pairs and spread with logAttrs...
  - Property paths are currently top-level keys only; nested path support (e.g., "order.id") would require a recursive lookup helper
---

## 2026-02-05 13:40 MST - US-018
- Built sidebar navigation component in components/sidebar.templ with links to Events (/events), Subscribers (/subscribers), and Logging Config (/logging)
- Updated SimplePage to accept currentPath parameter for active state highlighting
- Integrated sidebar into SimplePage layout — appears on all pages as a 256px wide panel on the left
- Uses DaisyUI `menu` component with `active` class for current page highlighting
- `isActive()` helper uses prefix matching so /events/123 still highlights the Events link
- SVG icons inline for each nav item (lightning bolt for Events, people for Subscribers, gear for Logging)
- Updated welcome.templ to pass currentPath="/welcome" to SimplePage
- Files changed: components/sidebar.templ (new), components/simple-page.templ (updated), views/welcome.templ (updated), plus generated _templ.go files
- **Learnings for future iterations:**
  - SimplePage now requires two params: `title` and `currentPath` — all future views must pass both
  - DaisyUI `menu` component with `active` class provides sidebar navigation styling out of the box with dark theme
  - Templ conditional attributes: use `if condition { class="active" }` inside an element to conditionally add attributes
  - Prefix matching for active state means /events, /events/123, /events/new all highlight "Events" — this is the expected UX
  - `go tool templ generate -f <file>` generates specific files; `go tool templ generate` with no args generates nothing if files haven't changed since last generate (uses file modification time caching)
---

## 2026-02-05 13:45 MST - US-019
- Updated root redirect from /welcome to /events in views/not_found.go
- Changed Location header value and updated comment
- Files changed: views/not_found.go (2 lines changed)
- **Learnings for future iterations:**
  - The root redirect lives in views/not_found.go in the notFound handler — it handles both "/" (redirect) and all unmatched paths (404)
  - Simple one-line change: the redirect path is a string literal in `w.Header().Set("Location", "/events")`
---

## 2026-02-05 13:50 MST - US-020
- Built events list page at /events with paginated table showing subject, truncated event ID, timestamp, and delivery status
- Templ template in views/events.templ with EventRow struct, truncateID helper, and statusBadgeClass for colored DaisyUI badges
- Go handler in views/events.go with pagination (50 per page, fetch N+1 to detect next page)
- Rows clickable via onclick + JS navigation to /events/{id}
- Previous/Next pagination controls with page number display
- Files changed: views/events.go (new), views/events.templ (new), views/events_templ.go (generated)
- **Learnings for future iterations:**
  - Templ types (structs, helper functions) defined in .templ files are accessible from .go files in the same package — EventRow defined in events.templ is used in events.go
  - For pagination, fetch Limit+1 rows and check len > Limit to determine hasNext without a separate COUNT query
  - pgtype.UUID to string: use `uuid.UUID(u.Bytes).String()` from google/uuid (same pattern as api package but in views package as pgtypeUUIDToString)
  - View routes use `"GET /events"` pattern (method prefix) unlike the catch-all `/` route which accepts all methods
  - DaisyUI badge classes: badge-success (green), badge-error (red), badge-warning (yellow), badge-info (blue), badge-ghost (gray)
---

## 2026-02-05 15:20 MST - US-021
- Built event search and filtering with a filter bar above the events table
- Filter bar has inputs for: subject (text, LIKE partial match), delivery status (dropdown), date range (start/end date inputs), content search (JSON containment via @> operator)
- Added `SearchEventsFiltered` sqlc query combining all optional filters with AND logic using empty-string-means-no-filter for text params and NULL-means-no-filter for timestamptz/jsonb params
- Filters update the event list via HTMX: form uses hx-get="/events" with hx-target="#events-results" and hx-push-url="true"
- HTMX partial rendering: handler checks `HX-Request` header and returns just the table+pagination (EventsTablePartial) for HTMX requests, full page for normal requests
- Pagination links preserve filter params via filterQueryString helper and also use HTMX for seamless navigation
- Clear button links back to /events (no filters)
- Files changed: queries/events.sql (added SearchEventsFiltered), db/events.sql.go (generated), views/events.go (refactored with filter parsing), views/events.templ (added filter bar, partial template), views/events_templ.go (generated)
- **Learnings for future iterations:**
  - sqlc.narg() with nullable text type override (text -> string) doesn't produce nullable Go types — use empty string convention ("" means no filter) instead of NULL for text params
  - sqlc.narg() for timestamptz produces pgtype.Timestamptz (despite time.Time override) — zero value pgtype.Timestamptz{} has Valid:false which maps to SQL NULL
  - HTMX partial rendering pattern: check r.Header.Get("HX-Request") == "true" to serve partial vs full page
  - filterQueryString helper in .templ file builds URL query strings preserving active filters across pagination
  - DaisyUI select with conditional selected attribute: `selected?={ condition }` in templ syntax
---

## 2026-02-05 15:30 MST - US-022
- Built event detail page at /events/{id} showing full event info and delivery history
- Templ template in views/event_detail.templ with EventDetail and DeliveryAttemptRow types
- Event info card displays: ID, subject, timestamp, trace ID, delivery status, retry count, status updated at, and pretty-printed JSON data
- Delivery attempts section with DaisyUI collapse components — each row shows endpoint URL, timestamp, status badge, and HTTP status code
- Expandable rows reveal full request/response details (headers and body)
- Go handler in views/events.go: eventDetailHandler fetches event via GetEventByID and delivery attempts via ListDeliveryAttemptsForEvent
- Added prettyJSON helper for formatting JSONB columns (request/response headers)
- Files changed: views/event_detail.templ (new), views/event_detail_templ.go (generated), views/events.go (added handler, imports)
- **Learnings for future iterations:**
  - DaisyUI collapse component: use `collapse collapse-arrow bg-base-200` with `<input type="checkbox"/>` for expandable rows
  - pgtype.Int4 nullable handling: check `.Valid` before formatting `.Int32` as string
  - prettyJSON helper pattern: unmarshal to interface{} then MarshalIndent for readable display of JSONB columns
  - The event detail route `GET /events/{id}` coexists with `GET /events` because Go 1.22+ ServeMux uses longest path match
---
